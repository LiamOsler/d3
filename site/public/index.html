<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="/styles/main.css">


    <title>Hello, world!</title>
  </head>
  <body>

    <div class="jumbotron jumbotron-fluid pb-1 pt-4">
      <div class="container">
        <h1 class="display-4">CORONAVIRUS - ONE YEAR ON</h1>
        <h1 class="display-2"><b>TRACKING UK PUBLIC PERCEPTION</b></h1>
        <p class="lead">A snapshot of <b>Ipsos MORI's</b> research and analysis related to the <b>COVID-19</b> coronavirus pandemic, one year after the first UK lockdown was announced.</p>
        <p class="lead"><b>25<sup>th</sup> March 2021</b></p>
        <p class="lead">For more information visit: <a href = "https://www.ipsos.com/en-uk/public-opinion-covid-19-coronavirus-pandemic"> <b>https://www.ipsos.com/en-uk/public-opinion-covid-19-coronavirus-pandemic</b></a></p>
      </div>
    </div>

    <div class="container pt-1">
      <div class = "row">
        <div class="card-group">
          <div class = "col-12 col-lg-6 p-3">
            <div class="card">
              <div class="card-body">
                <div class = "row">
                  <div class = "col-4 sidebar sidebar-1">
                    <div class = "sidebar-text p-3">
                      <h5 class="card-title"><b>PLANNING NHS RESPONSE</b></h5>
                      <p class="card-text">Confidence in the NHS is at its highest since June 2020</p>
                    </div>
                    <img src="images/NHS-logo.png" alt = "A picture of the NHS logo">
                  </div>
                  <div class = "col-8 p-3">
                    <p class="card-text">How confident, if at all, would you say you are in the ability of the NHS to deal with those who are ill as a result of getting the Coronavirus?</p>
                    <div id= "chart"></div>
                    <p>Find out more here: <a href = "https://www.ipsos.com/en-uk/confidence-ability-nhs-deal-covid-19-its-highest-last-june"> https://www.ipsos.com/en-uk/confidence-ability-nhs-deal-covid-19-its-highest-last-june</a></p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class = "col-12 col-lg-6 p-3">
            <div class="card">
              <div class="card-body">
                <div class = "row">
                  <div class = "col-4 sidebar sidebar-2">
                    <div class = "sidebar-text p-3">
                    <h5 class="card-title"><b>HOME TESTING STUDY</b></h5>
                    <p class="card-text">The largest testing programme for coronavirus shows a decline in prevalence of the virus</p>
                    </div>
                    <img src="images/test-kit.png" alt = "A picture of a home testing kit"/>
                  </div>
                  <div class = "col-8 pt-4">
                    <p class="card-text">COVID-19 home testing study over time</p>
                    <div id= "chart2"></div>
                    <p>Find out more here: <a href = "https://www.ipsos.com/en-uk/final-findings-latest-covid-19-react-1-study-published"> https://www.ipsos.com/en-uk/final-findings-latest-covid-19-react-1-study-published</a></p>

                  </div>
                </div>
              </div>
            </div>
          </div>


          <div class = "col-12 col-lg-6 p-3">
            <div class="card">
              <div class="card-body">
                <div class = "row">
                  <div class = "col-4 sidebar sidebar-2">
                    <div class = "sidebar-text p-3">
                    <h5 class="card-title"><b>VACCINATION INTENT</b></h5>
                    <p class="card-text">Intention among the UK public to get the COVID-19 vaccine has increased</p>
                    </div>
                    <img src="images/vial.png" alt = "A pair of eyes and part of a face looking at the viewer"/>
                  </div>
                  <div class = "col-8 pt-4">
                    <p class="card-text">If a vaccine for COVID-19 were available to me, I tould get it</p>
                    <div id= "chart3"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        
          
          <div class = "col-12 col-lg-6 p-3">
            <div class="card">
              <div class="card-body">
                <div class = "row">
                  <div class = "col-4 sidebar sidebar-2">
                    <div class = "sidebar-text p-3">
                    <h5 class="card-title"><b>THREAT</b></h5>
                    <p class="card-text">The perceived threat of the virus has fluctuated with the lockdowns - it now finally decreasing</p>
                    </div>
                    <img src="images/eyes.png" alt = "A picture of a home testing kit"/>
                  </div>
                  <div class = "col-8">
                    <div class = "col-8 pt-4">
                      <p class="card-text">What level of threat do you think the the coronavirus poses to...?</p>
                      <div id= "chart4"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class = "col-12 col-lg-6 p-3">
            <div class="card">
              <div class="card-body">
                <div class = "row">
                  <div class = "col-4 sidebar sidebar-1">
                    <div class = "sidebar-text p-3">
                      <h5 class="card-title"><b>FEELING OF CONTROL</b></h5>
                      <p class="card-text">The proportion saying that things feel out of control is falling fast</p>
                    </div>
                    <img src="images/test-strip.png" alt = "A picture of a gloved hand holding a thermometer">
                  </div>
                  <div class = "col-8 pt-4">
                    <p class="card-text">To what extent do you agree or disagree with each of the following? 'I feel like things in my country are out of control right now'</p>
                    <div id= "chart5"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class = "col-12 col-lg-6 p-3">
            <div class="card">
              <div class="card-body">
                <div class = "row">
                  <div class = "col-4 sidebar sidebar-2">
                    <div class = "sidebar-text p-3">
                    <h5 class="card-title"><b>OUTLOOK</b></h5>
                    <p class="card-text">One year on, the public is still divided on when things will return to normal</p>
                    </div>
                    <img src="images/binoculars.png" alt = "A picture of a home testing kit"/>
                  </div>
                  <div class = "col-8 pt-4">
                    <p class="card-text">How long do you think it will take before things feel like they are getting back to normal?</p>
                    <div id= "chart6"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class = "col-12 ">
            <div class="card sources">
              <div class="card-body">
                <div class = row>
                  
                  <div class = "col-8">
                    <p>*Source: Source: Ipsos tracking survey conducted on the Global Advisor online platform, 11th - 14th March 2021. 1,000 British adults aged 16-74. Online survey.
                    <br>
                    **Source: Ipsos MORI January 2021 Issues Index, c. 1,000 British adults aged 18+ each month. Face-to-face in home survey until April 2020, telephone survey thereafter.
                    <br>
                    ***Source: Ipsos MORI coronavirus polling, 19th - 22nd January 2021. 1,067 British adults aged 18-75. Online omnibus survey.
                    <br>
                    ****Source: Ipsos MORI home testing study for Imperial College London, 4th - 23rd February 2021. Postal swabs returned from 165,456 people.
                    </p>
                  </div>

                  <div class = "col-4">
                      <p>@Ipsos | Coronavirus tracking data | March 2021 | Public</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>  
    </div>
    
    

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS and d3 -->
    <script src="/jquery/jquery.min.js"></script>
    <script src="/@popperjs/popper.min.js" ></script>
    <script src="/bootstrap/bootstrap.min.js" ></script>
    <script src="/d3/d3.js" ></script>

    <script>
    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 150, bottom:  100, left: 50},
        width = 500 - margin.left - margin.right,
        height = 250 - margin.top - margin.bottom,
        tooltip = { width: 100, height: 100, x: 10, y: -30 };

    
    var formatPercent = d3.format(".0%");
    var parseTime = d3.timeParse("%d-%b-%y");
    var formatTime = d3.timeFormat("%e %B");

    var x = d3.scaleTime().range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);

    // define the 1st line
    var valueline = d3.line()
        .x(function(d) { return x(d.date); })
        .y(function(d) { return y(d.close); });

    // define the 2nd line
    var valueline2 = d3.line()
        .x(function(d) { return x(d.date); })
        .y(function(d) { return y(d.open); });

    var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);


    // append the svg object to the body of the page
    var svg = d3.select("#chart")
      .append("svg")
        .attr("viewBox", `0 0 500 250`)
        .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");


    d3.json("/data/data.json").then(function(data) {      
      console.log(data);
      
      // format the data
      data.forEach(function(d) {
          d.date = parseTime(d.date);
          d.close = +d.close;
      });
      
      x.domain(d3.extent(data, function(d) { return d.date; }));
      y.domain([0, 1]);
      

      // Add the valueline path.
      svg.append("path")
        .data([data])
        .attr("class", "line")
        .attr("d", valueline);

      // add the dots with tooltips
      svg.selectAll("dot")
        .data(data)
      .enter().append("circle")
        .style("stroke", "#294B96")
        .style("fill", "#294B96")
        .attr("r", 5)
        .attr("cx", function(d) { return x(d.date); })
        .attr("cy", function(d) { return y(d.close); })
        .on("mouseover", function(event,d) {
          div.transition()
            .duration(100)
            .style("opacity", 1)
            .style("color", "#294B96");

          div.html(formatTime(d.date) + "<br/>" + formatPercent(d.close) +" Not Confident")
            .style("left", (event.pageX) + "px")
            .style("top", (event.pageY - 28) + "px");
          })
        .on("mouseout", function(d) {
          div.transition()
            .duration(500)
            .style("opacity", 0);
          });


      // Add the valueline2 path.
      svg.append("path")
        .data([data])
        .attr("class", "line")
        .style("stroke", "#4E9B9A")
        .attr("d", valueline2);

        // add the dots with tooltips
      svg.selectAll("dot")
        .data(data)
      .enter().append("circle")
        .style("stroke", "#4E9B9A")
        .style("fill", "#4E9B9A")
        .attr("r", 5)
        .attr("cx", function(d) { return x(d.date); })
        .attr("cy", function(d) { return y(d.open); })
        .on("mouseover", function(event,d) {
          div.transition()
            .duration(200)
            .style("opacity", 1)
            .style("color", "#4E9B9A");
          div.html(formatTime(d.date) + "<br/>" + formatPercent(d.open)  +" Confident")
            .style("left", (event.pageX) + "px")
            .style("top", (event.pageY - 28) + "px");
          })
        .on("mouseout", function(d) {
          div.transition()
            .duration(500)
            .style("opacity", 0);
          });

      svg.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x)
          .tickFormat(d3.timeFormat("%b-%Y")))
        .selectAll("text")	
          .style("text-anchor", "end")
          .attr("dx", "-.8em")
          .attr("dy", ".15em")
          .attr("transform", "rotate(-90)");

      // Add the y Axis
      svg.append("g")
        .attr("class", "axis")
        .call(d3.axisLeft(y)
        .ticks(5)
        .tickFormat(formatPercent));

      svg.append("text")
        .attr("x", 340)
        .attr("y", 30)
        .text("79%")
        .attr("alignment-baseline","middle")
        .style('fill', '#69b3a2');

      svg.append("text")
        .attr("x", 340)
        .attr("y", 50)
        .text("Confident")
        .attr("alignment-baseline","middle")
        .style('fill', '#69b3a2');
        
      svg.append('rect')
        .attr('x', 320)
        .attr('y', 20)
        .attr('width', 10)
        .attr('height', 40)
        .attr('fill', '#69b3a2');

      svg.append("text")
        .attr("x", 340)
        .attr("y", 90)
        .text("17%")
        .attr("alignment-baseline","middle")
        .style('fill', '#294B96');

      svg.append("text")
        .attr("x", 340)
        .attr("y", 110)
        .text("Not Confident")
        .attr("alignment-baseline","middle")
        .style('fill', '#294B96');
        
      svg.append('rect')
        .attr('x', 320)
        .attr('y', 80)
        .attr('width', 10)
        .attr('height', 40)
        .attr('fill', '#294B96');
  
      });



          
      
    </script>

  </body>
</html>